params {
    // Required parameters
    patient_id = null
    samplesheet = null
    transcript_counts = null
    outdir_base = null

    // Optional parameters - these will be set dynamically in the workflow
    outdir_split_transcript_counts = null
    outdir_vcf_expression_annotator = null
    outdir_clean_vcf = null
}

// Set derived output directories if outdir_base is provided
if (params.outdir_base) {
    params.outdir_split_transcript_counts = params.outdir_split_transcript_counts ?: "${params.outdir_base}/split_transcript_counts"
    params.outdir_vcf_expression_annotator = params.outdir_vcf_expression_annotator ?: "${params.outdir_base}/vcf_expression_annotator"
    params.outdir_clean_vcf = params.outdir_clean_vcf ?: "${params.outdir_base}/clean_vcf"
}

profiles {
    test {
        // Override parameters for a test dataset
        params {
            patient_id = "PID_262622_"  // The underscore at the end is important for matching sample IDs in the transcript counts files
            samplesheet = "${projectDir}/tests/samplesheet.csv"
            transcript_counts = "${projectDir}/tests/data/salmon.merged.transcript_counts.tsv"
            outdir_base = "${projectDir}/tests/results/"
            
            // Set derived parameters for test profile
            outdir_split_transcript_counts = "${projectDir}/tests/results/split_transcript_counts"
            outdir_vcf_expression_annotator = "${projectDir}/tests/results/vcf_expression_annotator"
            outdir_clean_vcf = "${projectDir}/tests/results/clean_vcf"
        }
        // No container configuration here - let it be set by other profiles
    }

    singularity {
        singularity {
            enabled     = true
            autoMounts  = true
        }
    }

    docker {
        docker {
            enabled     = true
        }
    }
}
